#!/bin/bash
# 
# This will setup the docker container, build it if it
# doesn't exist, and then run the tests.

DOCKER_IMAGE=devops/course_tester

# Create docker base image if it doesn't exist
image=$(docker images | grep "$DOCKER_IMAGE" | wc -l)
if [ "$image" != "1" ]; then
	DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
	pushd "$DIR"
	docker build -t=$DOCKER_IMAGE .
	popd
fi

# Setup a docker instance to run our tests
APP_DIR='/app'
COURSE_LOCATION=$(cd "$1"; pwd)
COURSE_DIR='/course'

docker run -v "$COURSE_LOCATION":"$COURSE_DIR" -v "$PWD":"$APP_DIR" -w $APP_DIR $DOCKER_IMAGE bash -xe 'test_course'
